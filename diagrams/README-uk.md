# Описи діаграм проекту Drone Path API

## 1. Діаграма класів (Class Diagram)

Ця діаграма показує основні сутності системи та їх взаємозв'язки в контексті моделі даних MongoDB з використанням Mongoose.

### Основні класи:

**User (Користувач)**
- `username`: унікальне ім'я користувача
- `password`: хешований пароль
- `createdAt/updatedAt`: часові мітки
- Методи: `validatePassword()` для перевірки пароля, `toJSON()` для серіалізації

**Drone (Дрон)**
- `model`: модель дрону
- `serialNumber`: унікальний серійний номер
- `currentBatteryCharge`: поточний заряд батареї (0-100%)
- `totalFlightTime`: загальний час польоту в хвилинах
- `userId`: посилання на власника

**Route (Маршрут)**
- `name`: назва маршруту
- `droneId`: посилання на дрон
- `userId`: посилання на користувача
- `totalPoints`: загальна кількість точок
- `pointsWithPhotos`: кількість точок з фото
- `status`: статус обробки (processing/partial/complete)
- `points`: масив точок маршруту

**Point (Точка)**
- Геолокаційні дані: `latitude`, `longitude`, `altitude`
- Часові дані: `date`, `time`
- Дані сенсорів: `speed`, `course`, фото дані
- `photoUrl`: посилання на фото в MinIO
- `hasPhoto`: чи є фото для цієї точки

### Зв'язки:
- User володіє багатьма Drone (1:N)
- User володіє багатьма Route (1:N)
- Drone виконує багато Route (1:N)
- Route містить багато Point (1:N, вбудований масив)

## 2. Діаграма компонентів (Component Diagram)

Демонструє архітектуру додатку на рівні компонентів та їх взаємодію.

### Основні пакети:

**Controllers (Контролери)**
- `AuthController`: обробка аутентифікації (реєстрація, логін, профіль)
- `DroneController`: управління дронами (CRUD операції)
- `RouteController`: управління маршрутами та точками

**Models (Моделі)**
- `User Model`: модель користувача з методами валідації
- `Drone Model`: модель дрону з віртуальними зв'язками
- `Route Model`: модель маршруту з логікою статусів

**Services (Сервіси)**
- `MinIO Service`: робота з S3-сумісним сховищем для фото
- `SCV Service`: сервіс обробки даних маршрутів

**Middleware (Проміжне ПЗ)**
- `Auth Middleware`: перевірка JWT токенів
- `Error Handler`: централізована обробка помилок
- `Metrics Middleware`: збір метрик для Prometheus
- `Validation Middleware`: валідація вхідних даних

**Routes (Маршрути)**
- Організація API ендпоінтів по функціональним областям

**Config (Конфігурація)**
- `Database Config`: підключення до MongoDB
- `Monitoring Config`: налаштування Prometheus/Grafana

### Потік даних:
Express App → Middleware → Routes → Controllers → Models/Services

## 3. Діаграма послідовності (Sequence Diagram)

Показує процес створення нового маршруту з послідовною обробкою фото.

### Учасники:
- **User**: кінцевий користувач
- **Client App**: клієнтський додаток
- **Auth MW**: middleware аутентифікації
- **Route Controller**: контролер маршрутів
- **Route Model**: модель маршруту
- **MinIO Service**: сервіс зберігання фото
- **Database**: база даних MongoDB

### Процес:
1. Користувач ініціює створення маршруту через клієнт
2. Перевірка JWT токена аутентифікації
3. Валідація даних маршруту
4. Створення документа Route зі статусом "processing"
5. Циклічна обробка кожної точки маршруту:
   - Якщо точка має фото → завантаження в MinIO
   - Генерація URL для фото
   - Оновлення точки з photoUrl
6. Оновлення лічильників та статусу маршруту
7. Збереження оновленого маршруту
8. Повернення відповіді клієнту

## 4. Діаграма розгортання (Deployment Diagram)

Ілюструє інфраструктуру системи в середовищі Docker.

### Компоненти:

**Node.js App Container**
- Основний додаток на Express.js
- Порт: конфігурований
- Ендпоінти: `/health`, `/metrics`

**MongoDB Container**
- Зберігає: Users, Drones, Routes
- Аутентифікація: увімкнена

**MinIO Container**
- S3-сумісне сховище для фото
- Bucket: drone-photos
- Публічний доступ для завантажень

**Prometheus Container**
- Збирає метрики з API
- Зберігає часові ряди

**Grafana Container**
- Візуалізація метрик
- Кастомні дашборди

### Зв'язки:
Client Apps ↔ API (HTTP/HTTPS)
API ↔ MongoDB (запити до БД)
API ↔ MinIO (S3 операції)
API → Prometheus (push метрики)
Grafana ← Prometheus (pull метрики)

## 5. Діаграма пакетів (Package Diagram)

Відображає фізичну структуру проекту на рівні директорій та файлів.

### Структура src/:
- **controllers/**: логіка обробки HTTP запитів
- **models/**: схеми даних MongoDB
- **routes/**: налаштування API маршрутів
- **services/**: бізнес-логіка та зовнішні інтеграції
- **middleware/**: проміжне програмне забезпечення
- **config/**: конфігурація системи
- **utils/**: допоміжні утиліти
- `app.js`: основний Express додаток
- `server.js`: точка входу додатку

### Структура observability/:
- **grafana/**: конфігурація дашбордів та джерел даних
- **prometheus/**: конфігурація метрик

### Кореневі файли:
- `package.json`: залежності та скрипти
- `docker-compose.yml`: оркестрація контейнерів
- `dockerfile`: збірка образу додатку

## 6. Діаграма станів (State Diagram)

Показує життєвий цикл статусів маршруту під час обробки.

### Стани:

**processing** (обробка)
- Початковий стан після створення маршруту
- Фото ще не завантажені
- `pointsWithPhotos = 0`

**partial** (частково)
- Деякі точки мають фото
- `0 < pointsWithPhotos < totalPoints`
- Маршрут частково оброблений

**complete** (завершено)
- Всі точки мають фото
- `pointsWithPhotos = totalPoints`
- Обробка маршруту завершена

### Переходи:
- processing → partial: при завантаженні першого фото
- partial → complete: при завантаженні всіх фото
- processing → complete: якщо всі фото завантажені одразу

## 7. Діаграма активності (Activity Diagram)

Демонструє бізнес-процес створення маршруту з точки зору системи.

### Основний потік:

1. **Ініціація**: Користувач починає створення маршруту
2. **Аутентифікація**: Перевірка JWT токена
3. **Валідація**: Перевірка коректності даних маршруту
4. **Створення**: Ініціалізація документа Route в БД
5. **Обробка точок**: Цикл по кожній точці маршруту
   - Якщо є фото → завантаження в MinIO
   - Генерація URL та оновлення точки
6. **Оновлення статусу**: Визначення статусу на основі фото
7. **Збереження**: Фінальне збереження маршруту
8. **Відповідь**: Повернення результату клієнту

### Альтернативні потоки:
- Помилка аутентифікації → повернення 401
- Некоректні дані → повернення 400
- Помилка завантаження фото → відповідна обробка помилки

Ці діаграми забезпечують комплексне розуміння архітектури, процесів та структури проекту Drone Path API.
